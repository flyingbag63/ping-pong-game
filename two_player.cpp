/////////////////////////////Custom LCD Characters for Pong game/////////////////////////


///////////////////////////////////Player Paddle Characters///////////////////////////////////////
// Left Player Paddle Characters
byte paddlel1[8] = {
	0b00111,
	0b00111,
	0b00111,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000
};

byte paddlel2[8] = {
	0b00000,
	0b00111,
	0b00111,
	0b00111,
	0b00000,
	0b00000,
	0b00000,
	0b00000
};

byte paddlel3[8] = {
	0b00000,
	0b00000,
	0b00111,
	0b00111,
	0b00111,
	0b00000,
	0b00000,
	0b00000
};

byte paddlel4[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b00111,
	0b00111,
	0b00111,
	0b00000,
	0b00000
};

byte paddlel5[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00111,
	0b00111,
	0b00111,
	0b00000
};

byte paddlel6[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00111,
	0b00111,
	0b00111
};

byte paddlel7a[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00111,
	0b00111
};

byte paddlel7b[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00111
};

byte paddlel8a[8] = {
	0b00111,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000
};

byte paddlel8b[8] = {
	0b00111,
	0b00111,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000
};

// Right Player Paddle Characters
byte paddler1[8] = {
	0b11100,
	0b11100,
	0b11100,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000
};

byte paddler2[8] = {
	0b00000,
	0b11100,
	0b11100,
	0b11100,
	0b00000,
	0b00000,
	0b00000,
	0b00000
};

byte paddler3[8] = {
	0b00000,
	0b00000,
	0b11100,
	0b11100,
	0b11100,
	0b00000,
	0b00000,
	0b00000
};

byte paddler4[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b11100,
	0b11100,
	0b11100,
	0b00000,
	0b00000
};

byte paddler5[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b11100,
	0b11100,
	0b11100,
	0b00000
};

byte paddler6[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b11100,
	0b11100,
	0b11100
};

byte paddler7a[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b11100,
	0b11100
};

byte paddler7b[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b11100
};

byte paddler8a[8] = {
	0b11100,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000
};

byte paddler8b[8] = {
	0b11100,
	0b11100,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000,
	0b00000
};


///////////////////////////////////Ball Characters///////////////////////////////////////

// Row 1, Each Column
byte ball00[8] = {
  0b10000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball01[8] = {
  0b01000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball02[8] = {
  0b00100,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball03[8] = {
  0b00010,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball04[8] = {
  0b00001,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

// Row 2, Each Column
byte ball10[8] = {
  0b00000,
  0b10000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball11[8] = {
  0b00000,
  0b01000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball12[8] = {
  0b00000,
  0b00100,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball13[8] = {
  0b00000,
  0b00010,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball14[8] = {
  0b00000,
  0b00001,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

// Row 3, Each Column
byte ball20[8] = {
  0b00000,
  0b00000,
  0b10000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball21[8] = {
  0b00000,
  0b00000,
  0b01000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball22[8] = {
  0b00000,
  0b00000,
  0b00100,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball23[8] = {
  0b00000,
  0b00000,
  0b00010,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball24[8] = {
  0b00000,
  0b00000,
  0b00001,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

// Row 4, Each Column
byte ball30[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b10000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball31[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b01000,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball32[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00100,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball33[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00010,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball34[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00001,
  0b00000,
  0b00000,
  0b00000,
  0b00000  
};

// Row 5, Each Column
byte ball40[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b10000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball41[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b01000,
  0b00000,
  0b00000,
  0b00000  
};

byte ball42[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00100,
  0b00000,
  0b00000,
  0b00000  
};

byte ball43[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00010,
  0b00000,
  0b00000,
  0b00000  
};

byte ball44[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00001,
  0b00000,
  0b00000,
  0b00000  
};

// Row 6, Each Column
byte ball50[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b10000,
  0b00000,
  0b00000  
};

byte ball51[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b01000,
  0b00000,
  0b00000  
};

byte ball52[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00100,
  0b00000,
  0b00000  
};

byte ball53[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00010,
  0b00000,
  0b00000  
};

byte ball54[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00001,
  0b00000,
  0b00000  
};

// Row 7, Each Column
byte ball60[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b10000,
  0b00000  
};

byte ball61[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b01000,
  0b00000  
};

byte ball62[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00100,
  0b00000  
};

byte ball63[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00010,
  0b00000  
};

byte ball64[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00001,
  0b00000  
};

// Row 8, Each Column
byte ball70[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b10000  
};

byte ball71[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b01000  
};

byte ball72[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00100  
};

byte ball73[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00010  
};

byte ball74[8] = {
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00000,
  0b00001  
};


/////////////////////////////////////////////Winner Characters//////////////////////////////////

byte armsDown[8] = {
  0b00100,
  0b01010,
  0b00100,
  0b00100,
  0b01110,
  0b10101,
  0b00100,
  0b01010
};

byte armsUp[8] = {
  0b00100,
  0b01010,
  0b00100,
  0b10101,
  0b01110,
  0b00100,
  0b00100,
  0b01010
};

/***************************************************************************************************************************************/


// include the library code:
#include <LiquidCrystal.h>

// define push buttons
#define UP_LEFT 6
#define DOWN_LEFT 7
#define UP_RIGHT 8
#define DOWN_RIGHT 9
#define MAX_SCORE 5

// initialize the library with the numbers of the interface pins
LiquidCrystal lcd(12, 11, 5, 4, 3, 2);

//Globals
int upDownDir;			//Up/down state of the ball
int leftRightDir;		//left/right state of the ball
int angle;				//angle of the ball with X axis
float azimuth;			//clockwise angle with the Y axis 
int ballPos[2];			//(x,y) coordinates of the ball
bool gameStarted;		//state of the game
int paddlePosL;			//position of the left player's paddle
int paddlePosR;			//position of the right player's paddle
int pointsL;			//Left player's points
int pointsR;			//Right player's points
bool leftPlayerActive;	//Whether left player has pressed any left button or not
bool rightPlayerActive;	//Whether right player has pressed any right button or not
bool toDrawChar;			//Whether to draw the ball or not
float distance;			// Distance between successive positions of the ball
float totalDistance;	// Total distance from the ball's last boundary deflection (control) point, to calculate ball's trajectory

// Game Control Variables
float speedIncreasePercent = 8;      // Speed increase percentage when the player successfully bounces the ball off their paddle
int gameAngleMin = 10;                // Min trajectory angle for the ball
int gameAngleMax = 50;                // Max trajectory angle for the ball
float initialDist = 1.0;              // Initial Distance value that is used at the start of a game


void setup() {
	gameStarted = false;
	// set up the lcd's number of columns and rows: 
	lcd.begin(16, 2);

	// set button pins as inputs
	pinMode(UP_LEFT,INPUT);
	pinMode(DOWN_LEFT,INPUT);
	pinMode(UP_RIGHT,INPUT);
	pinMode(DOWN_RIGHT,INPUT);

	// calculate an initial trajectory angle for the ball
	calcInitialDir();

	// set the ball's initial position to centre screen
  	ballPos[0] = 39;
  	ballPos[1] = 7;

  	// initialize control variables to default values
  	distance = initialDist;
  	totalDistance = distance;
  	pointsL = 0;
  	pointsR = 0;

  	// display message for players to press any button to start the game
  	lcd.clear();
  	lcd.setCursor(0,0);
  	lcd.print("Press any button");
  	lcd.setCursor(0,1);
  	lcd.print("to start a game!");

}

void loop() {

	//initialize the active state of players to false
	leftPlayerActive = false;
	rightPlayerActive = false;

	//check the game state
	if(gameStarted) 
	{
		ballUpdate();				// Update the ball's position

		//Check if game to MAX_SCORE has ended
		if(gameStarted)
		{
			playerPaddleUpdateL();		// Update left player's paddle position		 
			playerPaddleUpdateR();		// Update right player's paddle position
		}
		delay(100);
	}

	else
	{
		//Check for button press
		if(digitalRead(UP_LEFT) || digitalRead(UP_RIGHT) || digitalRead(DOWN_LEFT) || digitalRead(DOWN_RIGHT))
		{
			//Start a game and initialize the game board
			gameStarted = true;
			drawInitial();
		}
	}
}

//Function to draw the initial state of the board
void drawInitial() {
	lcd.clear();

	//set paddle positions of left and right players
	paddlePosL = 6;
	paddlePosR = 6;

	leftPlayerActive = true;
	rightPlayerActive = true;

	playerPaddleUpdateL();			 
	playerPaddleUpdateR();

  	delay(500);

}

// Function for determining the ball's trajectory angle
void calcInitialDir() {
 // randomly get a 1 or -1 for the up/down and left/right directions and the ball's angle of travel from the X axis  
  upDownDir = 0;
  leftRightDir = 0;
  while (upDownDir == 0) {
    upDownDir = random(-1,2);
  }
  while (leftRightDir == 0) {
    leftRightDir = random(-1,2);
  }
  // Randomly grab a game angle between Min and Max values
  randomSeed(analogRead(1));
  angle = random(gameAngleMin,gameAngleMax + 1);

}

//Function to update left player's paddle position based on the input from left buttons
void playerPaddleUpdateL() {
	if(digitalRead(UP_LEFT) == HIGH)	//left player pressed UP_LEFT button
	{
		leftPlayerActive = true;
		if(paddlePosL > 1)
			paddlePosL -= 1;
	}
	else if(digitalRead(DOWN_LEFT) == HIGH)		//left player pressed DOWN_LEFT button
	{
		leftPlayerActive = true;
		if(paddlePosL < 14)
			paddlePosL += 1;
	}

	//if left player pressed any button
	if(leftPlayerActive)
	{
		//clear the paddle
		lcd.setCursor(0,0);
		lcd.print(" ");
		lcd.setCursor(0,1);
		lcd.print(" ");
		//select the correct custom character,of the 14 possible, draw the paddle position using the correct custom LCD Character
		switch(paddlePosL)
		{
			case 1: lcd.createChar(6,paddlel1);
					lcd.setCursor(0,0);
					lcd.write(6);
					break;

			case 2: lcd.createChar(7,paddlel2);
					lcd.setCursor(0,0);
					lcd.write(7);
					break;

			case 3: lcd.createChar(6,paddlel3);
					lcd.setCursor(0,0);
					lcd.write(6);
					break;

			case 4: lcd.createChar(7,paddlel4);
					lcd.setCursor(0,0);
					lcd.write(7);
					break;

			case 5: lcd.createChar(6,paddlel5);
					lcd.setCursor(0,0);
					lcd.write(6);
					break;

			case 6: lcd.createChar(7,paddlel6);
					lcd.setCursor(0,0);
					lcd.write(7);
					break;

			case 7: lcd.createChar(6,paddlel7a);
					lcd.setCursor(0,0);
					lcd.write(6);
					lcd.createChar(7,paddlel8a);
					lcd.setCursor(0,1);
					lcd.write(7);
					break;

			case 8: lcd.createChar(6,paddlel7b);
					lcd.setCursor(0,0);
					lcd.write(6);
					lcd.createChar(7,paddlel8b);
					lcd.setCursor(0,1);
					lcd.write(7);
					break;

			case 9: lcd.createChar(6,paddlel1);
					lcd.setCursor(0,1);
					lcd.write(6);
					break;

			case 10: lcd.createChar(7,paddlel2);
					 lcd.setCursor(0,1);
					 lcd.write(7);
					 break;

			case 11: lcd.createChar(6,paddlel3);
					 lcd.setCursor(0,1);
					 lcd.write(6);
					 break;

			case 12: lcd.createChar(7,paddlel4);
					 lcd.setCursor(0,1);
					 lcd.write(7);
					 break;

			case 13: lcd.createChar(6,paddlel5);
					 lcd.setCursor(0,1);
					 lcd.write(6);
					 break;

			case 14: lcd.createChar(7,paddlel6);
					 lcd.setCursor(0,1);
					 lcd.write(7);
					 break; 
		}
	}
}

//Function to update right player's paddle position based on the input from left buttons
void playerPaddleUpdateR() {

	if(digitalRead(UP_RIGHT) == HIGH)		//right player pressed UP_RIGHT button
	{
		rightPlayerActive = true;
		if(paddlePosR > 1)
			paddlePosR -= 1;
	}
	else if(digitalRead(DOWN_RIGHT) == HIGH)	//right player pressed DOWN_RIGHT button
	{
		rightPlayerActive = true;
		if(paddlePosR < 14)
			paddlePosR += 1;
	}

	//if right player pressed any button
	if(rightPlayerActive)
	{
		//clear the paddle
		lcd.setCursor(15,0);
		lcd.print(" ");
		lcd.setCursor(15,1);
		lcd.print(" ");

		//select the correct custom character,of the 14 possible, draw the paddle position using the correct custom LCD Character
		switch(paddlePosR)
		{
			case 1: lcd.createChar(4,paddler1);
					lcd.setCursor(15,0);
					lcd.write(4);
					break;

			case 2: lcd.createChar(5,paddler2);
					lcd.setCursor(15,0);
					lcd.write(5);
					break;

			case 3: lcd.createChar(4,paddler3);
					lcd.setCursor(15,0);
					lcd.write(4);
					break;

			case 4: lcd.createChar(5,paddler4);
					lcd.setCursor(15,0);
					lcd.write(5);
					break;

			case 5: lcd.createChar(4,paddler5);
					lcd.setCursor(15,0);
					lcd.write(4);
					break;

			case 6: lcd.createChar(5,paddler6);
					lcd.setCursor(15,0);
					lcd.write(5);
					break;

			case 7: lcd.createChar(4,paddler7a);
					lcd.setCursor(15,0);
					lcd.write(4);
					lcd.createChar(5,paddler8a);
					lcd.setCursor(15,1);
					lcd.write(5);
					break;

			case 8: lcd.createChar(4,paddler7b);
					lcd.setCursor(15,0);
					lcd.write(4);
					lcd.createChar(5,paddler8b);
					lcd.setCursor(15,1);
					lcd.write(5);
					break;

			case 9: lcd.createChar(4,paddler1);
					lcd.setCursor(15,1);
					lcd.write(4);
					break;

			case 10: lcd.createChar(5,paddler2);
					 lcd.setCursor(15,1);
					 lcd.write(5);
					 break;

			case 11: lcd.createChar(4,paddler3);
					 lcd.setCursor(15,1);
					 lcd.write(4);
					 break;

			case 12: lcd.createChar(5,paddler4);
					 lcd.setCursor(15,1);
					 lcd.write(5);
					 break;

			case 13: lcd.createChar(4,paddler5);
					 lcd.setCursor(15,1);
					 lcd.write(4);
					 break;

			case 14: lcd.createChar(5,paddler6);
					 lcd.setCursor(15,1);
					 lcd.write(5);
					 break; 
		}
	}
}

//Fucntion for updating ball's position on the LCD screen using one of the 40 possible characters
void ballUpdate() {

	toDrawChar = true;			//ball can be drawn on the board

	// Calculate the azimuth of the ball's game angle (trajectory angle)
	if (upDownDir == 1 && leftRightDir == -1)
		azimuth = 90 - angle;
	else if (upDownDir == -1 && leftRightDir == -1)
		azimuth = 90 + angle;
	else if (upDownDir == -1 && leftRightDir == 1)
		azimuth = 270 - angle;
	else
		azimuth = 270 + angle;

	// Convert degrees to radians
	azimuth = azimuth * PI / 180.0;

	// Solve for the ball's new position (uses the ball's last deflection point along with total distance)
	int newX = sin(azimuth) * totalDistance + (float)ballPos[0];
	int newY = cos(azimuth) * totalDistance + (float)ballPos[1]; 

	// Constrain the ball's position to be on the game board
	newX = constrain(newX, 5, 75);
	newY = constrain(newY, 0, 15);

	// Update the total distance between the ball and it's last deflection (bounce) point within the game 
	totalDistance = totalDistance + distance;


	//Check if the ball has hit the top or bottom boundary and if so update its up/down state
	if(newY == 0)		//Hit the bottom
	{
		upDownDir = 1;
		totalDistance = distance;
		ballPos[0] = newX;
		ballPos[1] = newY + 1;
	}

	else if(newY == 15)		//Hit the top
	{
		upDownDir = -1;
		totalDistance = distance;
		ballPos[0] = newX;
		ballPos[1] = newY - 1;
	}

	//Check if the ball has hit a left/right boundary and if so update its left/right state

	if(newX == 5)			//Hit left player's boundary
	{
		// Speed up the ball each time it hits the player's paddle
    	distance = (1.0 + speedIncreasePercent / 100.0) * distance;

    	//Check to see if the player's paddle was in the correct position to bounce the ball

    	if(newY == 0 && (paddlePosL == 14 || paddlePosL == 13))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 1 && (paddlePosL == 14 || paddlePosL == 13 || paddlePosL == 12))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 2 && (paddlePosL == 14 || paddlePosL == 13 || paddlePosL == 12 || paddlePosL == 11))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 3 && (paddlePosL == 14 || paddlePosL == 13 || paddlePosL == 12 || paddlePosL == 11 || paddlePosL == 10))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 4 && (paddlePosL == 13 || paddlePosL == 12 || paddlePosL == 11 || paddlePosL == 10 || paddlePosL == 9))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 5 && (paddlePosL == 12 || paddlePosL == 11 || paddlePosL == 10 || paddlePosL == 9 || paddlePosL == 8))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 6 && (paddlePosL == 11 || paddlePosL == 10 || paddlePosL == 9 || paddlePosL == 8 || paddlePosL == 7))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 7 && (paddlePosL == 10 || paddlePosL == 9 || paddlePosL == 8 || paddlePosL == 7 || paddlePosL == 6))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 8 && (paddlePosL == 9 || paddlePosL == 8 || paddlePosL == 7 || paddlePosL == 6 || paddlePosL == 5))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 9 && (paddlePosL == 8 || paddlePosL == 7 || paddlePosL == 6 || paddlePosL == 5 || paddlePosL == 4))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 10 && (paddlePosL == 7 || paddlePosL == 6 || paddlePosL == 5 || paddlePosL == 4 || paddlePosL == 3))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 11 && (paddlePosL == 6 || paddlePosL == 5 || paddlePosL == 4 || paddlePosL == 3 || paddlePosL == 2))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 12 && (paddlePosL == 5 || paddlePosL == 4 || paddlePosL == 3 || paddlePosL == 2 || paddlePosL == 1))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 13 && (paddlePosL == 4 || paddlePosL == 3 || paddlePosL == 2 || paddlePosL == 1))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 14 && (paddlePosL == 3 || paddlePosL == 2 || paddlePosL == 1))
    		hitPaddleUpdateL(newX,newY);
    	else if(newY == 15 && (paddlePosL == 2 || paddlePosL == 1))
    		hitPaddleUpdateL(newX,newY);

    	//the ball has crossed left player's boundary
    	else
    	{
    		pointsR++;			//right player got one point
    		displayScore();
    		delay(500);

    		//Reset the ball's position and control variables for the next point
      		ballPos[0] = 39;
      		ballPos[1] = 7;
      		distance = initialDist;		//to initialize the ball speed to initialDist,comment it to make game harder
      		totalDistance = distance;
      		drawInitial();
      		// Determine a new game angle for this point
      		calcInitialDir();

      		toDrawChar = false;		//to avoid multiple balls on the screen

      		//MAX_SCORE has been scored by the right player, reset the LCD Screen, display the winner message
      		if(pointsR == MAX_SCORE)
      		{
      			gameStarted = false;

      			displayWinner('R');
      			delay(500);

      			//Call the setup to start the game again
      			setup();
      		} 
    	}
	}

	else if(newX == 75)			//Hit right player's boundary
	{
		// Speed up the ball each time it hits the player's paddle
    	distance = (1.0 + speedIncreasePercent / 100.0) * distance;

    	//Check to see if the player's paddle was in the correct position to bounce the ball

    	if(newY == 0 && (paddlePosR == 14 || paddlePosR == 13))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 1 && (paddlePosR == 14 || paddlePosR == 13 || paddlePosR == 12))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 2 && (paddlePosR == 14 || paddlePosR == 13 || paddlePosR == 12 || paddlePosR == 11))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 3 && (paddlePosR == 14 || paddlePosR == 13 || paddlePosR == 12 || paddlePosR == 11 || paddlePosR == 10))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 4 && (paddlePosR == 13 || paddlePosR == 12 || paddlePosR == 11 || paddlePosR == 10 || paddlePosR == 9))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 5 && (paddlePosR == 12 || paddlePosR == 11 || paddlePosR == 10 || paddlePosR == 9 || paddlePosR == 8))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 6 && (paddlePosR == 11 || paddlePosR == 10 || paddlePosR == 9 || paddlePosR == 8 || paddlePosR == 7))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 7 && (paddlePosR == 10 || paddlePosR == 9 || paddlePosR == 8 || paddlePosR == 7 || paddlePosR == 6))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 8 && (paddlePosR == 9 || paddlePosR == 8 || paddlePosR == 7 || paddlePosR == 6 || paddlePosR == 5))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 9 && (paddlePosR == 8 || paddlePosR == 7 || paddlePosR == 6 || paddlePosR == 5 || paddlePosR == 4))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 10 && (paddlePosR == 7 || paddlePosR == 6 || paddlePosR == 5 || paddlePosR == 4 || paddlePosR == 3))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 11 && (paddlePosR == 6 || paddlePosR == 5 || paddlePosR == 4 || paddlePosR == 3 || paddlePosR == 2))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 12 && (paddlePosR == 5 || paddlePosR == 4 || paddlePosR == 3 || paddlePosR == 2 || paddlePosR == 1))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 13 && (paddlePosR == 4 || paddlePosR == 3 || paddlePosR == 2 || paddlePosR == 1))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 14 && (paddlePosR == 3 || paddlePosR == 2 || paddlePosR == 1))
    		hitPaddleUpdateR(newX,newY);
    	else if(newY == 15 && (paddlePosR == 2 || paddlePosR == 1))
    		hitPaddleUpdateR(newX,newY);

    	//the ball has crossed right player's boundary
    	else
    	{
    		pointsL++;			//left player got one point
    		displayScore();
    		delay(500);

    		//Reset the ball's position and control variables for the next point
      		ballPos[0] = 39;
      		ballPos[1] = 7;
      		distance = initialDist;		//to initialize the ball speed to initialDist,comment it to make game harder
      		totalDistance = distance;
      		drawInitial();
      		// Determine a new game angle for this point
      		calcInitialDir();

      		toDrawChar = false;		//to avoid multiple balls on the screen

      		//MAX_SCORE has been scored by the right player, reset the LCD Screen, display the winner message
      		if(pointsL == MAX_SCORE)
      		{
      			gameStarted = false;

      			displayWinner('L');
      			delay(500);

      			//Call the setup to start the game again
      			setup();
      		} 
    	}
	}

	//if game is not over, update the ball's position
	if(gameStarted && toDrawChar)
		drawChars(newX,newY);
}

//function to perform necessary updates when ball hits left player's paddle
void hitPaddleUpdateL(int X,int Y) {
	leftRightDir = -1;
	totalDistance = distance;
	ballPos[0] = X + 1;
	ballPos[1] = Y;
}

//function to perform necessary updates when ball hits left player's paddle
void hitPaddleUpdateR(int X,int Y) {
	leftRightDir = 1;
	totalDistance = distance;
	ballPos[0] = X - 1;
	ballPos[1] = Y;
}

//function to determine which one of the 40 ball characters to be drawn on the screen and where
void drawChars(int X,int Y) {
	int LCDrow;
	int LCDcol;

	//determine which row of the LCD ball is on
	if(Y < 8)
		LCDrow = 1;
	else
		LCDrow = 0;

	//determine which column of the LCD ball is on
	if(X < 5)
		LCDcol = 1;
	else if(X < 10)
		LCDcol = 1;
	else if(X < 15)
		LCDcol = 2;
	else if(X < 20)
		LCDcol = 3;
	else if(X < 25)
		LCDcol = 4;
	else if(X < 30)
		LCDcol = 5;
	else if(X < 35)
		LCDcol = 6;
	else if(X < 40)
		LCDcol = 7;
	else if(X < 45)
		LCDcol = 8;
	else if(X < 50)
		LCDcol = 9;
	else if(X < 55)
		LCDcol = 10;
	else if(X < 60)
		LCDcol = 11;
	else if(X < 65)
		LCDcol = 12;
	else if(X < 70)
		LCDcol = 13;
	else if(X < 75)
		LCDcol = 14;
	else 
		LCDcol = 14;

	//clear the LCD of the previous ball but not the players' paddle
	lcd.setCursor(1,0);
	//14 empty characters between players' paddles
	lcd.print("              ");
	lcd.setCursor(1,1);
	lcd.print("              ");

	//determine the ball's position within a single LCD character
	//(i.e. within the 8x5 pixels that make up a single LCD character)
	int dx = X - (5*LCDcol);		//Column position within the LCD character
	int dy;

	if(Y == 0 || Y == 8)
		dy = 0;
	else if(Y == 1 || Y == 9)
		dy = 1;
	else if(Y == 2 || Y == 10)
		dy = 2;
	else if(Y == 3 || Y == 11)
		dy = 3;
	else if(Y == 4 || Y == 12)
		dy = 4;
	else if(Y == 5 || Y == 13)
		dy = 5;
	else if(Y == 6 || Y == 14)
		dy = 6;
	else if(Y == 7 || Y == 15)
		dy = 7;

	//select the corect custom character and display it in its correct position on the LCD screen
	if(dx == 0 && dy == 0)
	{
		lcd.createChar(1,ball70);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(1);
	}
	else if(dx == 1 && dy == 0)
	{
		lcd.createChar(1,ball71);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(1);
	}
	else if(dx == 2 && dy == 0)
	{
		lcd.createChar(1,ball72);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(1);
	}
	else if(dx == 3 && dy == 0)
	{
		lcd.createChar(1,ball73);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(1);
	}
	else if(dx == 4 && dy == 0)
	{
		lcd.createChar(1,ball74);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(1);
	}

	else if(dx == 0 && dy == 1)
	{
		lcd.createChar(2,ball60);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(2);
	}
	else if(dx == 1 && dy == 1)
	{
		lcd.createChar(2,ball61);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(2);
	}
	else if(dx == 2 && dy == 1)
	{
		lcd.createChar(2,ball62);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(2);
	}
	else if(dx == 3 && dy == 1)
	{
		lcd.createChar(2,ball63);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(2);
	}
	else if(dx == 4 && dy == 1)
	{
		lcd.createChar(2,ball64);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(2);
	}

	else if(dx == 0 && dy == 2)
	{
		lcd.createChar(3,ball50);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(3);
	}
	else if(dx == 1 && dy == 2)
	{
		lcd.createChar(3,ball51);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(3);
	}
	else if(dx == 2 && dy == 2)
	{
		lcd.createChar(3,ball52);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(3);
	}
	else if(dx == 3 && dy == 2)
	{
		lcd.createChar(3,ball53);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(3);
	}
	else if(dx == 4 && dy == 2)
	{
		lcd.createChar(3,ball54);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(3);
	}

	else if(dx == 0 && dy == 3)
	{
		lcd.createChar(0,ball40);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write((byte)0);
	}
	else if(dx == 1 && dy == 3)
	{
		lcd.createChar(0,ball41);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write((byte)0);
	}
	else if(dx == 2 && dy == 3)
	{
		lcd.createChar(0,ball42);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write((byte)0);
	}
	else if(dx == 3 && dy == 3)
	{
		lcd.createChar(0,ball43);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write((byte)0);
	}
	else if(dx == 4 && dy == 3)
	{
		lcd.createChar(0,ball44);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write((byte)0);
	}

	else if(dx == 0 && dy == 4)
	{
		lcd.createChar(1,ball30);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(1);
	}
	else if(dx == 1 && dy == 4)
	{
		lcd.createChar(1,ball31);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(1);
	}
	else if(dx == 2 && dy == 4)
	{
		lcd.createChar(1,ball32);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(1);
	}
	else if(dx == 3 && dy == 4)
	{
		lcd.createChar(1,ball33);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(1);
	}
	else if(dx == 4 && dy == 4)
	{
		lcd.createChar(1,ball34);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(1);
	}

	else if(dx == 0 && dy == 5)
	{
		lcd.createChar(2,ball20);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(2);
	}
	else if(dx == 1 && dy == 5)
	{
		lcd.createChar(2,ball21);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(2);
	}
	else if(dx == 2 && dy == 5)
	{
		lcd.createChar(2,ball22);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(2);
	}
	else if(dx == 3 && dy == 5)
	{
		lcd.createChar(2,ball23);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(2);
	}
	else if(dx == 4 && dy == 5)
	{
		lcd.createChar(2,ball24);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(2);
	}

	else if(dx == 0 && dy == 6)
	{
		lcd.createChar(3,ball10);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(3);
	}
	else if(dx == 1 && dy == 6)
	{
		lcd.createChar(3,ball11);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(3);
	}
	else if(dx == 2 && dy == 6)
	{
		lcd.createChar(3,ball12);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(3);
	}
	else if(dx == 3 && dy == 6)
	{
		lcd.createChar(3,ball13);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(3);
	}
	else if(dx == 4 && dy == 6)
	{
		lcd.createChar(3,ball14);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write(3);
	}

	else if(dx == 0 && dy == 7)
	{
		lcd.createChar(0,ball00);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write((byte)0);
	}
	else if(dx == 1 && dy == 7)
	{
		lcd.createChar(0,ball01);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write((byte)0);
	}
	else if(dx == 2 && dy == 7)
	{
		lcd.createChar(0,ball02);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write((byte)0);
	}
	else if(dx == 3 && dy == 7)
	{
		lcd.createChar(0,ball03);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write((byte)0);
	}
	else if(dx == 4 && dy == 7)
	{
		lcd.createChar(0,ball04);
		lcd.setCursor(LCDcol,LCDrow);
		lcd.write((byte)0);
	}

}

void displayScore() {
	for (int i = 0; i < 5; ++i)
	{
		//print 14 empty characters between players' paddles
		lcd.setCursor(1,0);
		lcd.print("              ");
		lcd.setCursor(1,1);
		lcd.print("              ");

		//print the scores
		//left player score
		lcd.setCursor(6,0);
		lcd.print(pointsL);

		lcd.setCursor(7,0);
		lcd.print("-");

		//right player score
		lcd.setCursor(8,0);
		lcd.print(pointsR);

		delay(500);
	}
}

//function to display the winner of the game
void displayWinner(char winner) {
	
	lcd.clear();
	lcd.createChar(1,armsUp);
	lcd.createChar(2,armsDown);

	if(winner == 'L')
	{
		//a little animation to make the screen interesting
		while(1)
		{
			lcd.setCursor(0,0);
			lcd.print("Winner");
			lcd.setCursor(0,1);
			lcd.print("Press any button");
			for (int i = 7; i < 16; ++i)
			{
				lcd.setCursor(i,0);
				lcd.write(1);
				delay(100);
				lcd.setCursor(i,0);
				lcd.write(2);
				delay(100);
				lcd.setCursor(i,0);
				lcd.print(" ");
				if(digitalRead(UP_LEFT) || digitalRead(DOWN_LEFT) || digitalRead(UP_RIGHT) || digitalRead(DOWN_RIGHT))
					return;
			}
			
			if(digitalRead(UP_LEFT) || digitalRead(DOWN_LEFT) || digitalRead(UP_RIGHT) || digitalRead(DOWN_RIGHT))
				return;
		}
	}

	else
	{
		//a little animation to make the screen interesting
		while(1)
		{
			lcd.setCursor(10,0);
			lcd.print("Winner");
			lcd.setCursor(0,1);
			lcd.print("Press any button");
			for (int i = 8; i > -1; i--)
			{
				lcd.setCursor(i,0);
				lcd.write(1);
				delay(100);
				lcd.setCursor(i,0);
				lcd.write(2);
				delay(100);
				lcd.setCursor(i,0);
				lcd.print(" ");
				if(digitalRead(UP_LEFT) || digitalRead(DOWN_LEFT) || digitalRead(UP_RIGHT) || digitalRead(DOWN_RIGHT))
					return;
			}
			
			if(digitalRead(UP_LEFT) || digitalRead(DOWN_LEFT) || digitalRead(UP_RIGHT) || digitalRead(DOWN_RIGHT))
				break;
		}
	}

	delay(250);
}